- content_for :head do
  = javascript_include_tag "pages/staff/courses/show-bundle"
  = stylesheet_link_tag "pages/staff/courses/show-bundle", :media => "all"
  :javascript
    window.cid = "#{@course_inst.id.to_s}"
    window.capacity = "#{@course_inst.capacity}"
    window.price = "#{@course_inst.price}"
    window.price_pay = "#{@course_inst.price_pay}"
    window.length = "#{@course_inst.length}"
    window.date_in_calendar = "#{@course_inst.date_in_calendar_str}"
    window.profile = "#{@profile}"
    window.address = "#{@course_inst.address}"
    window.speaker = "#{@course_inst.speaker}"
    window.code = "#{@course_inst.code}"

.content-area
  .main-top.direction
    %a{href: staff_courses_path}
      %img.back{src: asset_path("back.png")}
    = render "staff/partials/account_set"
    
  .main-content.bg2
    %button.btn.delete-normal.font-color1.delete-btn-position#delete-btn{type: "button"} 删除
    - if @course_inst.available == true
      %button.btn.delete-normal.font-color1.unshelve-btn-position#unshelve-btn.operation.available{type: "button"} 下架
    - else
      %button.btn.new-normal.font-color1.unshelve-btn-position#shelve-btn.operation.unavailable{type: "button"} 上架
    %button.btn.edit-normal.font-color1.create-btn-position#edit-btn{type: "button"} 编辑
    %button.btn.edit-normal.font-color1.create-btn-position#finish-btn{type: "button"} 完成

    .table-div
      .tabbable
        %ul.nav.nav-tabs
          %li.active
            %a.f16.font-color1#course-message{"data-toggle" => "tab", :href => "#tab1"} 课程详情
          %li
            %a.f16.font-color1#register-message{"data-toggle" => "tab", :href => "#tab2"} 报名信息
          %li
            %a.f16.font-color1#course-sign{"data-toggle" => "tab", :href => "#tab3"} 课程签到
          %li
            %a.f16.font-color1#statistics{"data-toggle" => "tab", :href => "#tab4"} 统计信息
          %li
            %a.f16.font-color1#user-review{"data-toggle" => "tab", :href => "#tab5"} 家长评价
        .tab-content.bg3.f14.font-color3
          #tab1.tab-pane.active
            .desc-div.font-color3
              .top-box.clearfix
                .text-message 
                  .form-inline.name-bottom
                    %label.input-caption 课程名称:
                    %span#name-span= @course_inst.name
                  .form-inline
                    %label.input-caption 上课时间:
                    %span.unedit-box#date-span= @course_inst.date
                    %span.edit-box
                      %input.input-area.form-control.long-input#course-date{:type => "text"}
                  .form-inline
                    %label.input-caption 上课中心:
                    %span.unedit-box#center-span= @course_inst.center.name
                    %span.edit-box
                      %input.input-area.form-control.long-input#course-center{:type => "text"}
                .photo
                  %img.unedit-photo{:src => @course_inst.photo.nil? ? asset_path("photo-course.png") : @course_inst.photo.path }
                  = form_tag("/staff/courses/" + @course_inst.id.to_s + "/upload_photo", method: "post", multipart: true, id: "upload-photo-form", class: "hide") do
                    = file_field_tag "photo_file", { class: "hide", accept: ".jpg,.png" }
                  %a#upload-photo{href: "javascript:void(0);"}
                    %img.edit-photo#photo{src: asset_path("photo-course.png")}

              .controls.controls-row
                %label.input-caption 开课编号:
                %span.num-box
                  %span.course-num= @course_inst.course.code + '-'
                  %span.unedit-box#num-span= @course_inst.inst_code
                  %span.edit-box
                    %input.input-area.form-control#course-num{:type => "text"}
                %label.input-caption.course-speaker.caption-left 主讲人:
                %span.unedit-box#speaker-span= @course_inst.speaker
                %span.edit-box
                  %input.input-area.form-control#course-speaker{:type => "text"}
                %label.input-caption.kids-capacity 容量:
                %span.unedit-box#capacity-span= @course_inst.capacity
                %span.edit-box
                  %input.input-area.form-control#course-capacity{:type => "text"}
              .controls.controls-row
                %label.input-caption 上课教室:
                %span.unedit-box#classroom-span= @course_inst.address
                %span.edit-box
                  %input.input-area.form-control#classroom{:type => "text"}
                %label.input-caption.course-times 课次:
                %span.unedit-box#times-span= @course_inst.length
                %span.edit-box
                  %input.input-area.form-control#course-times{:type => "text"}
                %label.input-caption.course-price 价格:
                %span.unedit-box#charge-span= @course_inst.price
                %span.edit-box
                  %input.input-area.form-control#course-charge{:type => "text"}
              .calendar-wrapper.clearfix
                %label.class-calendar 课程日历:
                .show-calendar#calendar
                .calendar-operation-wrapper
                  %p.title 课程日历
                  %p.small-tips （单击日历中的时间进行删除）
                  .form-inline
                    %label.input-date 上课日期:
                    %input.input-area.form-control#datepicker{:type => "text"}
                  .form-inline
                    %label.input-date 开始时间:
                    %input.input-area.form-control#start-time{:type => "text"}
                  .form-inline
                    %label.input-date 结束时间:
                    %input.input-area.form-control#end-time{:type => "text"}
                  .btn#add-event{:type => "button"} 添加单次
                  .repeat.clearfix
                    %button.btn.date-btn#date-btn{:type => "button"} 次日重复
                    %button.btn.week-btn#week-btn{:type => "button"} 每周重复
          #tab2.tab-pane
            .desc-div
              - if @participates[:data].blank?
                .undiscover
                  %img.undiscover-icon{src: asset_path("undiscover.png")}
              - else
                .table-box.border-btm
                  %table.table.table-hover.table-height
                    %thead.th-bg.font-color2
                      %tr
                        %th 学生姓名
                        %th 手机号
                        %th 家庭住址
                        %th 报名状态
                        %th 课&nbsp次
                    %tbody.font-color3
                      - @participates[:data].each do |p|
                        %tr
                          %td= p.client.name
                          %td= p.client.mobile
                          %td= p.client.address
                          %td= p.status_str
                          %td
                            - if p.is_success
                              %a.details.font-color-brown{href: "javascript:void(0);"} 
                                上课情况
                                %span.triangle-down
                        - if p.is_success
                          %tr.status
                            %td{colspan: "5"}
                              .course-status
                                %span.item-status 上课状态：
                                - p.course_inst.length.times do |i|
                                  - if p.signin_info[i].present?
                                    %span.join-square
                                  - else
                                    - if p.course_inst.is_class_pass?(i)
                                      %span.miss-square
                                    - else
                                      %span.square
                              .comments
                                %span.comments-title 评价：
                                %span.comments-content= p.review.present? ? p.review.content : "暂未评价"
                = render "staff/partials/auto_paginate", locals: { instance: @participates, url: "/staff/courses/" + @course_inst.id.to_s + "?profile=participates&", page: 'participate_page'}
                      
          #tab3.tab-pane
            .desc-div
              - if @course_inst.course_participates.where(trade_state: "SUCCESS").blank? 
                .undiscover
                  %img.undiscover-icon{src: asset_path("undiscover.png")}
              - else
                .sign-box.clearfix
                  .sign-method.font-color3
                    .class-choice
                      .form-group.choice-lesson
                        %label.input-caption 课次选择：
                        = select_tag "class_num", options_for_select((1..@course_inst.length).to_a.map { |e| ["第" + e.to_s + "次课", e-1] }), class: 'form-control lesson-input font-color3'
                    .method
                      %p.caption 签到方式一：扫描签到
                      #qr-code
                        %img.code-figure{src: asset_path("bigqrcode.png")}
                      %p.caption 签到方式二：手机号签到
                      %input#sign-mobile.font-color3.form-control.mobile-input{:type => "text"}
                      .btn.sign-btn{:type => "button"} 立即签到
                      .mask
                        %p.notice 该次课程已结束点击此处补签到
                  .sign-status-box
                    .sign-status
                      %h5 签到情况
          #tab4.tab-pane
            .desc-div
              .courses-income-box
                %p.income-title 课程收入
                .income-div
                  .income-items
                    %p.income-caption 收入统计(元)
                    %p.income-nums= @income_stat[:all]
                  
              .pie-box
                .gender-pie
                  %p.pie-title 性别比例
                  .figure-box
                    #gender-statistics
                .age-pie
                  %p.pie-title 年龄比例
                  .figure-box
                    #age-statistics
              .kids-nums
                %p.column-title 报名情况
                .figure-box
                  #nums-statistics
              .attend-status
                %p.attend-title 出勤情况
                .figure-box
                  #attend-statistics
          #tab5.tab-pane
            .desc-div
              - if @reviews[:data].blank?
                .undiscover
                  %img.undiscover-icon{src: asset_path("undiscover.png")}
              - else
                .user-review-box
                  - @reviews[:data].each do |r|
                    .review-items
                      .img-div
                        %img.avatar-icon{src: r.client.avatar.present? ? r.client.avatar.path : asset_path("avatar-icon.png")}
                      .review-div
                        .head-div.clearfix
                          %p.user-name.fl.font-color2= r.client.name
                          - if r.is_private
                            .btn.fr.finish-normal.font-color1.show-review{type: "button", data: { id: r.id.to_s}} 公开评论
                          - else
                            .btn.fr.edit-normal.font-color1.hide-review{type: "button", data: { id: r.id.to_s}} 隐藏评论
                        %p.reviews= r.content
                        .time-div.font-color4
                          %span.review-date= r.created_at.strftime("%Y-%m-%d %H:%M")
                = render "staff/partials/auto_paginate", locals: { instance: @reviews, url: "/staff/courses/" + @course_inst.id.to_s + "?profile=reviews&", page: 'review_page'}       


