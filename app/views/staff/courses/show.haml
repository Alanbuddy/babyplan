- content_for :head do
  = javascript_include_tag "pages/staff/courses/show-bundle"
  = stylesheet_link_tag "pages/staff/courses/show-bundle", :media => "all"
  :javascript
    window.cid = "#{@course_inst.id.to_s}"
    window.capacity = "#{@course_inst.capacity}"
    window.price = "#{@course_inst.price}"
    window.price_pay = "#{@course_inst.price_pay}"
    window.length = "#{@course_inst.length}"
    window.date_in_calendar = "#{@course_inst.date_in_calendar_str}"
    window.profile = "#{@profile}"

.content-area
  .manage-content
    .btn.finish-btn{:type => "button"} 
      %img.ticker{:src => "/assets/managecenter/ticker.png"}
      完成
    .btn.edit-btn{:type => "button"} 
      %img.edit{:src => "/assets/managecenter/edit.png"}
      编辑
    - if @course_inst.available == true
      .btn.unshelve-btn.available{:type => "button"} 
        %img.end{:src => "/assets/managecenter/unshelve.png"}
        %span 下架
    - else
      .btn.unshelve-btn.unavailable{:type => "button"} 
        %img.end{:src => "/assets/managecenter/shelve.png"}
        %span 上架
    .tabbable
      %a{:href => "/staff/courses"}
        %img.back{:src => "/assets/web/tab-back.png"}
      %ul.nav.nav-tabs
        %li.active
          %a#course-message{"data-toggle" => "tab", :href => "#tab1"} 课程信息
        %li
          %a#register-message{"data-toggle" => "tab", :href => "#tab2"} 报名信息
        %li
          %a#user-review{"data-toggle" => "tab", :href => "#tab3"} 用户评价
        %li
          %a#course-sign{"data-toggle" => "tab", :href => "#tab4"} 课程签到
        %li
          %a#statistics{"data-toggle" => "tab", :href => "#tab5"} 统计信息

      .tab-content
        #tab1.tab-pane.active
          .top-box.clearfix
            .text-message
              %form.form-inline
                %label.input-caption 课程名称:
                %span#name-span= @course_inst.name
              %form.form-inline
                %label.input-caption 上课时间:
                %span.unedit-box#date-span= @course_inst.date
                %span.edit-box
                  %input.input-area.form-control#course-date{:type => "text"}
              %form.form-inline
                %label.input-caption 上课地址:
                %span.unedit-box#address-span= @course_inst.address
                %span.edit-box
                  %input.input-area.form-control#course-address{:type => "text"}
            .photo
              %img.unedit-photo{:src => @course_inst.photo.nil? ? "/assets/banner.png" : @course_inst.photo.path }
              = form_tag("/staff/courses/" + @course_inst.id.to_s + "/upload_photo", method: "post", multipart: true, id: "upload-photo-form", class: "hide") do
                = file_field_tag "photo_file", { class: "hide", accept: ".jpg,.png" }
              %a#upload-photo{href: "javascript:void(0);"}
                %img.edit-photo{:src => "/assets/web/photo.png"}

          .controls.controls-row
            %label.input-caption 开课编号:
            %span.num-box
              %span.course-num= @course_inst.course.code + "-" 
              %span.unedit-box#num-span= @course_inst.inst_code
              %span.edit-box
                %input.input-area.form-control#course-num{:type => "text"}
            %label.input-caption.course-speaker 主讲人:
            %span.unedit-box#speaker-span= @course_inst.speaker
            %span.edit-box
              %input.input-area.form-control#course-speaker{:type => "text"}
            %label.input-caption.kids-capacity 容量:
            %span.unedit-box#capacity-span= @course_inst.capacity.to_s + "人"
            %span.edit-box
              %input.input-area.form-control#course-capacity{:type => "text"}
          .controls.controls-row
            %label.input-caption.course-times 课次:
            %span.unedit-box#times-span= @course_inst.length.to_s + "次"
            %span.edit-box
              %input.input-area.form-control#course-times{:type => "text"}
            %label.input-caption 市场价:
            %span.unedit-box#charge-span= @course_inst.price.to_s + "元"
            %span.edit-box
              %input.input-area.form-control#course-charge{:type => "text"}
            %label.input-caption 公益价:
            %span.unedit-box#public-span= @course_inst.price_pay.to_s + "元"
            %span.edit-box
              %input.input-area.form-control#public-charge{:type => "text"}
          .calendar-wrapper.clearfix
            %label.class-calendar 课程日历:
            .show-calendar#calendar
            .calendar-operation-wrapper
              %p.title 课程日历
              %p.small-tips （单击日历中的时间进行删除）
              %form.form-inline
                %label.input-date 上课日期:
                %input.input-area.form-control#datepicker{:type => "text"}
              %form.form-inline
                %label.input-date 开始时间:
                %input.input-area.form-control#start-time{:type => "text"}
              %form.form-inline
                %label.input-date 结束时间:
                %input.input-area.form-control#end-time{:type => "text"}
              .btn#add-event{:type => "button"} 添加单次
              .repeat.clearfix
                .btn.date-btn{:type => "button"} 次日重复
                .btn.week-btn{:type => "button"} 每周重复

        #tab2.tab-pane
          - if @participates[:data].blank?
            .undiscover
              %img.undiscover-icon{:src => "/assets/managecenter/undiscover.png"}
              %span.undiscover-message 抱歉！暂无查找信息
          - else
            .table-box
              %table.table.table-bordered#register-table
                %thead
                  %tr
                    %th 姓&nbsp名
                    %th 住&nbsp址
                    %th 电&nbsp话
                    %th 操&nbsp作
                %tbody
                  / - @books[:data].each do |b|
                  /   %tr{class: "book-record #{ b[:available] ? "available" : "unavailable" }", "data-id" => b[:id]}
                  - @participates[:data].each do |e|
                    %tr
                      %td.td-data= e.client.name
                      %td.td-data= e.client.address
                      %td.td-data= e.client.mobile
                      %td.td-data
                        %a.details{:href => "javascript:void(0);"} 
                          上课情况
                          %span.triangle-down
                    %tr.status
                      %td{:colspan => "4"}
                        .course-status
                          %span.item-status 上课状态：
                          - e.course_inst.length.times do |i|
                            - if e.signin_info[i].present?
                              %span.join-square
                            - else
                              - if e.course_inst.is_class_pass?(i)
                                %span.miss-square
                              - else
                                %span.square
                        .comments
                          %span.comments-title 评论：
                          %span.comments-content= e.review.present? ? e.review.content : "暂未评论"
                  / %tr
                  /   %td.td-data 李星
                  /   %td.td-data 朝阳区新街口外大街27号院
                  /   %td.td-data 13324567865
                  /   %td.td-data
                  /     %a.details{:href => "javascript:void(0);"} 
                  /       上课情况
                  /       %span.triangle-down
                  / %tr.status
                  /   %td{:colspan => "4"}
                  /     .course-status
                  /       %span.item-status 上课状态：
                  /       %span.join-square
                  /       %span.join-square
                  /       %span.join-square
                  /       %span.join-square
                  /       %span.square
                  /       %span.miss-square
                  /       %span.square
                  /       %span.square
                  /       %span.square
                  /       %span.square
                  /     .comments
                  /       %span.comments-title 评论：
                  /       %span.uncomment 暂未评论

            .select-page 
              %span.totalitems= "共#{@participates[:total_page]}页,总计#{@participates[:total_number]}条"
              %span.choice-page
                %ul.pagination.pagination-sm
                  %li
                    %a{:href => "/staff/courses/" + @course_inst.id.to_s + "?profile=participates&participate_page=#{@participates[:previous_page]}"} «
                  - ( (@participates[:previous_page] > 2 ? @participates[:previous_page] - 2 : 1) .. (@participates[:next_page] < @participates[:total_page] - 2 ? @participates[:next_page] + 2 : @participates[:total_page]) ).to_a.each do |page|
                    %li
                      %a{:href => "/staff/courses/" + @course_inst.id.to_s + "?profile=participates&participate_page=#{page}"}= page
                  %li
                    %a{:href => "/staff/courses/" + @course_inst.id.to_s + "?profile=participates&participate_page=#{@participates[:next_page]}"} »

        #tab3.tab-pane
          .user-checkbox
            %label.checkbox-inline
              %input#inlineCheckbox1{:type => "checkbox", :value => "option1"} 未公开
            %label.checkbox-inline
              %input#inlineCheckbox2{:type => "checkbox", :value => "option2"} 已公开
          - if @reviews[:data].blank?
            .undiscover
              %img.undiscover-icon{:src => "/assets/managecenter/undiscover.png"}
              %span.undiscover-message 抱歉！暂无查找信息
          - else
            .user-review-box
              - @reviews[:data].each do |r|
                .book-description
                  .user-item.clearfix
                    %img.book-img{:src => r.client.avatar.present? ? r.client.avatar.path : "/assets/web/boy.png"}
                    %p.user-name
                      %span= r.client.name
                      - r.score.times do
                        %img.star-img{:src => "/assets/managecenter/star.png"}
                    %p.date= r.created_at.strftime("%Y-%m-%d %H:%M")
                    %p.user-review-content= r.content
                    %p.review-status#open 公开
            .select-page 
              %span.totalitems= "共#{@reviews[:total_page]}页,总计#{@reviews[:total_number]}条"
              %span.choice-page
                %ul.pagination.pagination-sm
                  %li
                    %a{:href => "/staff/courses/" + @course_inst.id.to_s + "?profile=reviews&review_page=#{@reviews[:previous_page]}"} «
                  - ( (@reviews[:previous_page] > 2 ? @reviews[:previous_page] - 2 : 1) .. (@reviews[:next_page] < @reviews[:total_page] - 2 ? @reviews[:next_page] + 2 : @reviews[:total_page]) ).to_a.each do |page|
                    %li
                      %a{:href => "/staff/courses/" + @course_inst.id.to_s + "?profile=reviews&review_page=#{page}"}= page
                  %li
                    %a{:href => "/staff/courses/" + @course_inst.id.to_s + "?profile=reviews&review_page=#{@reviews[:next_page]}"} »
          
        #tab4.tab-pane
          .sign-box.clearfix
            .sign-method
              .class-choice
                %form.form-horizontal
                  .form-group
                    %label.col-sm-5.col-md-3.control-label{:for => "class"} 课次选择
                    .col-sm-6.col-md-6
                      = select_tag "class_num", options_for_select((1..@course_inst.length).to_a.map { |e| ["第" + e.to_s + "次课", e-1] }), class: 'form-control'
              .method
                %p.caption 签到方式一：扫描签到
                #qr-code
                  %img.code-figure{:src => "/assets/web/bigqrcode.png"}
                %p.caption 签到方式二：手机号签到
                %input#sign-mobile.form-control{:type => "text"}
                .btn.sign-btn{:type => "button"} 立即签到
                .mask
                  %p.notice 该次课程已结束点击此处补签到
            .sign-status-box
              .sign-status
                %h5 签到情况
                %table.table.table-bordered#sign-table
                  %tbody
                    %tr
                      %td.sign-data 小赵
                      %td.sign-data 小钱
                      %td.sign-data 小孙
                      %td.sign-data 小李
                      %td.sign-data.check-in 小周
                    %tr
                      %td.sign-data 小赵
                      %td.sign-data.check-in 小钱
                      %td.sign-data 小孙
                      %td.sign-data 小李
                      %td.sign-data 小周
                    %tr
                      %td.sign-data 小赵
                      %td.sign-data 小钱
                      %td.sign-data.check-in 小孙
                      %td.sign-data 小李
                      %td.sign-data 小周
                    %tr
                      %td.sign-data 小赵
                      %td.sign-data 小钱
                      %td.sign-data 小孙
                      %td.sign-data.check-in 小李
                      %td.sign-data 小周
                    %tr
                      %td.sign-data.check-in 小赵
                      %td.sign-data 小钱
                      %td.sign-data 小孙
                      %td.sign-data 小李
                      %td.sign-data 小周

        #tab5.tab-pane
          .courses-income-box
            %p.income-title 课程收入
            .income-div
              .income-items
                %p.income-caption 收入统计(元)
                %p.income-nums 100000
              .income-items
                %p.income-caption 个人支付(元)
                %p.income-nums 100000
              .income-items#goverment
                %p.income-caption 政府补贴(元)
                %p.income-nums 100000
          .pie-box
            .gender-pie
              %p.pie-title 性别比例
              .figure-box
                #gender-statistics
            .age-pie
              %p.pie-title 年龄比例
              .figure-box
                #age-statistics
          .kids-nums
            %p.column-title 报名情况
            .figure-box
              #nums-statistics
          .attend-status
            %p.attend-title 出勤情况
            .figure-box
              #attend-statistics


#dialog-confirm{:title => "警告"}
  %p
    %span.ui-icon.ui-icon-alert{:style => "float:left; margin:12px 12px 20px 0;"}>
    确定删除？
        
